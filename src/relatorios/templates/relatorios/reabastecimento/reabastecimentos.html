{% extends 'home_template/pages/base.html' %}
{% load static %}

{% block title %} Rel√°tios {% endblock  %}

{% block head %}
    <link rel="stylesheet" href="{% static 'relatorios/css/lista.css' %}">



    <style>
      table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
            page-break-inside: auto;
        }

        thead {
            background-color: #2c3e50;
            color: white;
        }

        th, td {
            border: 1px solid #ccc;
            padding: 6px 8px;
            text-align: left;
        }

        tbody tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tfoot td {
            font-weight: bold;
            background-color: #f1f1f1;
        }
    </style>
{% endblock  %}



{% block main %}

    <div class="campo-pagina">
        <h2 class="titulo-listagem">Reabastecimentos</h2>

        <nav class="nav-pesquisa">
            <form method="GET" class="form">

                <div class="filtros-primarios">
                    <input 
                        type="text" 
                        class="form-input" 
                        placeholder="Pesquisar..." 
                        name="q"
                        value="{{ request.GET.q }}"
                    >

                    <input 
                        type="date"
                        name="data_inicio"
                        class="form-data"
                        value="{{ request.GET.data_inicio }}"
                    >
                    <input 
                        type="date"
                        name="data_fim"
                        class="form-data"
                        value="{{ request.GET.data_fim }}"
                    >
                </div>
                <div class="filtros-secundarios">
                    <select name="funcionario" id="funcionario" class="form-select">
                        <option value="">Funcion√°rios</option>
                        
                        {% for funcionario in funcionarios %}
                            <option 
                                value="{{ funcionario.id }}"
                                {% if request.GET.funcionario == funcionario.id|stringformat:"s" %}
                                    selected
                                {% endif %}
                            >
                                {{ funcionario.nome_funcionario }}
                            </option>
                        {% endfor %}
                            
                    </select>
                    <select name="tanque" id="tanque" class="form-select">
                        <option value="">Tanques</option>
                        {% for tipo in tanques %}
                            <option 
                                value="{{ tipo.id}}"
                                {% if request.GET.tanque == tipo.id|stringformat:"s" %}
                                    selected
                                {% endif %}
                            >
                                {{tipo.identificador_tanque}}
                            </option>
                        {% endfor %}
                            
                    </select>
                    <select name="tipo_combustivel" id="tipo_combustivel" class="form-select">
                        <option value="">Combust√≠veis</option>
                        {% for tipo in tipos_combustivel %}
                            <option 
                                value="{{ tipo.id}}"
                                {% if request.GET.tipo_combustivel == tipo.id|stringformat:"s" %}
                                    selected
                                {% endif %}
                            >
                                {{tipo.nome_combustivel}}
                            </option>
                        {% endfor %}
                            
                    </select>
                    <select name="forma_pagamento" id="forma_pagamento" class="form-select">
                        <option value="">
                            Formas de pagamento
                        </option>
                    </select>
                </div>
                <button type="submit" class="button-pesquisa">
                    üîç
                </button>
                
                
            </form>            
            <a 
                href="{% url 'relatorios:relatorio_reabastecimento_detalhes_pdf' %}?{{request.GET.urlencode }}" 
                class="opcao-pdf"
                >
                    BAIXAR RELAT√ìRIO
            </a>
        </nav>

        
        {% if registros %}
            
            <table class="tabela">

                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Respons√°vel</th>
                        <th>Tanque</th>
                        <th>Fornecedor</th>
                        <th>Combust√≠vel</th>
                        <th>Litros</th>
                        <th>Valor</th>
                        <th>Forma de pagamento</th>
                    </tr>
                </thead>

                {% for reabastecimento in registros %}
                    <tbody>
                        <tr>    
                            <td>{{ reabastecimento.criado }}</td>
                            <td>
                                {% if reabastecimento.funcionario %}
                                
                                    {{ reabastecimento.funcionario }}
                                    
                                {% else %}
                                    
                                    {{ reabastecimento.empresa }}

                                {% endif %}
                            </td>
                            <td>{{ reabastecimento.tanque.identificador_tanque }}</td>
                            <td>{{ reabastecimento.fornecedor.nome_fantasia }}</td>
                            <td>{{ reabastecimento.tanque.tipo_combustivel }}</td>
                            <td>{{ reabastecimento.quantidade }}</td>
                            <td>{{ reabastecimento.valor_total_reabastecimento }}</td>
                            <td>{{ reabastecimento.get_forma_pagamento_display }}</td>
                        </tr>
                    </tbody>
                {% endfor %}
            </table>
        {% endif %}
            

            
            
        <p><strong>Total de litros:</strong> {{ total_litros }}L</p>
        <p><strong>Total em reais:</strong> R$ {{ total_valor|floatformat:2 }}</p>

    </div>
{% endblock  %}